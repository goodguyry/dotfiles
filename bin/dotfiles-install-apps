#!/bin/bash
#
# Copyright (c) 2024 Ryan Domingue and contributors
# Report bugs at: https://github.com/goodguyry/dotfiles/issues
#
# This is free software with ABSOLUTELY NO WARRANTY.
#
# usage: dotfiles install apps

# Force calling via `dotfiles`.
if [[ -z "${DOTFILES_ROOT}" ]]; then
  printf 'usage: %s\n' "$(basename -- "$0" | sed -e 's/-/ /g')";
  exit 1;
fi

# Source setup files.
source "${DOTFILES_ROOT}/lib/installbrews";
source "${DOTFILES_ROOT}/lib/setfile";
source "${DOTFILES_ROOT}/lib/status";

# Homebrew is required.
! [ -z "$(type -P brew)" ] && status --error 'Homebrew is required';

# Install apps.
source var/packages.macos.sh;
[ ${#BREW_CASK_LIST[@]} -gt 0 ] && installbrews --cask "${BREW_CASK_LIST[@]}";

if [ ${#MAS_APPS_LIST[@]} -gt 0 ]; then
  for APP in "${MAS_APPS_LIST[@]}"; do
    mas install "${APP}";
  done;

  [[ $? ]] \
    && status --success 'App Store apps are ready.' \
    || status --error 'There was a problem installing App Store apps.';
fi
