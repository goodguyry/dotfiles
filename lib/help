#!/bin/bash


# ***
# Help text
# ***
function run_help() {

cat <<EOT

Dotfiles - Ryan Domingue - http://ryandomingue.com/

Usage: $(basename "$0") [options]

Options:
    -h, --help            Print this help text
    -c, --copy            Copy the files in place instead of linking
    -n, --no-packages     Suppress package installations and updates (including casks)
    -s, --server          Skip OS X-related packages/settings

 Notes:

 1. `gitconfig` is always copied, regardless of the option passed.
 2. `--copy` and `--server` also suppress initializing a Git repo and pulling updates from Github

Documentation can be found at https://github.com/goodguyry/dotfiles

Copyright (c) Ryan Domingue
Licensed under the MIT license.
EOT

}


# Create a directory if it doesn't already exist
function mkdirs() {
  if [[ ! -d $@ ]]; then
    mkdir $@;
    echo "Created $@";
  fi;
}


function dotfiles() {
  # Test for --strip-dir option
  if [[ $@ =~ "--strip-dir" ]] ; then
    STRIP=true;
    # Remove "--strip-dir"
    DIR=${@//--strip-dir};
  else
    STRIP=false;
    DIR="$@";
  fi;

  function set_file() {
    local SRC="$DOTFILES_DIRECTORY/$1";
    local DEST="$HOME/.$2";
    if [[ $COPY_FILES ]]; then
      rsync -avz --quiet $SRC $DEST;
    else
      # Force create/replace the symlink.
      ln -fs $SRC $DEST;
    fi;
  }

  for index in $DIR; do
    ITEM="${index}";
    if [[ ! " ${EXCLUDED_FILES[@]} " =~ " ${index} " ]]; then
      # This file is not in the exclude list
      if $STRIP; then
        # Strip the directory from the origin path
        ITEM="${index#*/}";
      fi;
      if [[ -r ${index} ]]; then
        set_file ${index} ${ITEM};
      fi;
    fi;
    unset ITEM;
  done;

  unset STRIP;
  unset DIR;
}
